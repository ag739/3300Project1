<!-- Kelly O'Shaughessy kao58,
	-->
<!DOCTYPE html>
<html>
<head>
	<link href='https://fonts.googleapis.com/css?family=Raleway:400,700italic' rel='stylesheet' type='text/css'>

	<!-- Load the d3 library. -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
	<script src="legend.js"></script>
	<script src="data/condensed_food_intake_by_country.js"></script>
	<script>

		var grain_colors = ["#ff9900", "ffcc99"];
		var veg_colors = ["#98e698"];
		var fruit_colors = ["#ff9999"];
		var oil_colors = ["ffeb99", "#ffffcc", "#e6e600",];
		var milk_colors = ["#99ccff", "ccffff"];
		var protein_colors = ["#ccccff","#cc99ff","#993399", "6666ff"];
		var total_colors = ["#d1d1e0"];

		var countries = [];
		data.forEach(function(obj) {
			countries.push(obj.Country);
		});
		//padding
		countries.push("");

		/*Creating x & y scale functions that map data to SVG coordinates*/
		var range = 850 - 125;
		var x_padding = 125;
		var y_padding = 50;

		var padding = 50;
		var x_pad = 4;

		var xscale = d3.scale.ordinal()
					.domain(countries)
					.rangePoints([125, 850]);

		var yscale_grain = d3.scale.linear().domain([0, 2500]).range([450, y_padding]);
		var yscale_veg = d3.scale.linear().domain([0, 200]).range([450, y_padding]);
		var yscale_fruit = d3.scale.linear().domain([0, 250]).range([450, y_padding]);
		var yscale_oil = d3.scale.linear().domain([0, 1500]).range([450, y_padding]);
		var yscale_milk = d3.scale.linear().domain([0, 500]).range([450, y_padding]);
		var yscale_protein = d3.scale.linear().domain([0, 600]).range([450, y_padding]);
		var yscale_total = d3.scale.linear().domain([0, 4000]).range([450, y_padding]);

		/* Graph Legend */
		function createLegend(svg, legendData, divID) {
			var colors;
			if (divID == "Grains") { colors = grain_colors; }
			else if (divID == "Vegetables") { colors = veg_colors; }
			else if (divID == "Fruits") { colors = fruit_colors; }
			else if (divID == "Oils") { colors = oil_colors; }
			else if (divID == "Dairy") { colors = milk_colors; }
			else if (divID == "Protein") { colors = protein_colors;}
			else {colors = total_colors;}

			sampleOrdinal = d3.scale.ordinal().domain(legendData)
							.range(colors);
			legendGraph = d3.svg.legend().labelFormat("none")
							.cellPadding(5)
							.orientation("vertical")
							.units("Ingredient")
							.cellWidth(25)
							.cellHeight(18)
							.inputScale(sampleOrdinal)
							.cellStepping(10);
			svg.append("g").attr("transform", "translate(884,100)")
							.attr("class", "legend")
							.call(legendGraph);
		}
		/* Makes graphs */
		function createGraph(divID, legendData, titleColor, yscale) {
			var height = 650, width = 1000;
			
			//Container
			var svg_container = d3.select("#" + divID).append("svg")
							.attr("width", width + 350)
							.attr("height", height);
							// .style("border", " 1px solid #ccc");

			//Axes
			var xaxis = d3.svg.axis().scale(xscale)
						.orient("bottom")
						.tickSize(0)
						
			var yaxis = d3.svg.axis().scale(yscale)
						.orient("left")
						.ticks(4)
						.tickSize(4,1);

			//adding & transforming scales
			svg_container.append("g")
					.attr("transform", "translate(0,500)")
					.attr("class", "axis")
					.attr("fill", "#ccc")
					.attr("stroke-width","2")
					.call(xaxis)
					.selectAll("text")
						.style("text-anchor","end")
						.style("font-size","11")
						.attr("dx","-.8em")
						.attr("dy",".15em")
						.attr("transform","rotate(-60), translate(5,9)");
			svg_container.append("g")
						.attr("transform", "translate(125,50)")
						.attr("class", "axis")
						.attr("fill", "#ccc")
						.attr("stroke-width","2")
						.call(yaxis)
						.selectAll("text")
							.style("font-size","14");

			// food pyramid img
			var img = svg_container.append("svg:image")
						.attr("xlink:href", "img/" + divID.toLowerCase() + ".png")
					    .attr("width", 300)
					    .attr("height", 232)
					    .attr("x", 875)
					    .attr("y",height/2 - 232/2);

			//Labels:
			//Country
			svg_container.append("text")
							.attr("x", range/2 + x_padding)
							.attr("y",610)
							.style("text-anchor", "middle")
							.text("Country")
							.style("font-size",18);
			//Intake
			svg_container.append("text")
							.attr("x", -300).attr("y",40)
							.style("text-anchor", "middle")
							.text("Intake")
							.attr("transform", "rotate(-90)")
							.style("font-size", 18);
			//unit
			svg_container.append("text")
							.attr("x", -230).attr("y",40)
							.style("text-anchor", "middle")
							.text("(kcal/day)")
							.attr("transform", "rotate(-90)")
							.style("font-size", 14);
			//Title
			svg_container.append("text")
							.attr("x", range/2 + x_padding).attr("y",30)
							.style("text-anchor", "middle")
							.text(divID)
							.style("font-size", 28)
							.style("font-stlye", "underline")
							.style("fill",titleColor);

			//Legend
			createLegend(svg_container, legendData, divID);
			return svg_container;
		}

	</script>
	<title>INFO 3300 Project 1</title>
	<style>
		body { 
			font-family: 'Raleway', sans-serif; 
		}
		svg { 
			font-weight: bold; 
			font-family: 'Raleway', sans-serif;
		}
		div {
			border-top: 3px solid gray; 
			padding-top:20px;
		}	
		a, 
		a:link, 
		a:visited { 
			color: gray;
		}
		.axis text {
			fill: black;
		}
		.axis path,
		.axis line {
	  		fill: none;
	  		stroke: #ccc;
	  		shape-rendering: crispEdges;
  		}	
	</style>

</head>
<body>

	<h1>Food Intake by Country</h1>
	<p>Ever wonder how food intake, based on what our "daily recommended values", relates to average BMI?
		We're looking at countries' food intake, based on the daily recommended values for each food group, to see if there's a relationship between that and BMI.
		Although the food pyramid was discontinued in 2011, the data we gathered is from 2010, so we figured it is an okay way to represent our data.
		<br>Food pyramid image found <a href="https://en.wikipedia.org/wiki/MyPyramid" target="_blank">here</a>.
		<br>Note: "daily recommended values" based on US statistics from <a href="http://health.gov/dietaryguidelines/dga2010/dietaryguidelines2010.pdf" target="_blank"> here</a>.
		<br><span style="color: rgb(51, 133, 255); opacity: 0.5;">This color</span> indicates male averages, while <span style="color: rgb(255, 128, 223); opacity: 0.5; ">this color</span> indicates female averages.
	</p>
	<div id = "Grains">
		<script>
		var svg_grains = createGraph("Grains", ["Wheat","Carbs"], "#ff794d",yscale_grain);

		data.forEach(function(obj) {
			svg_grains.append("rect")
						.attr("x", xscale(obj.Country) +x_pad)
						.attr("y", yscale_grain(obj.Carbohydrates) + padding)
						.attr("width", 15)
						.attr("height", yscale_grain(0) - yscale_grain(obj.Carbohydrates))
						.style("fill", grain_colors[1])
						.style("stroke", "#ccc")
						.style("stroke-width", "1");

			svg_grains.append("rect")
						.attr("x", xscale(obj.Country) +x_pad)
						.attr("y", yscale_grain(obj.Wheat) + padding)
						.attr("width", 15)
						.attr("height", yscale_grain(0) - yscale_grain(obj.Wheat))
						.style("fill", grain_colors[0])
						.style("stroke", "#ccc")
						.style("stroke-width", "1");
		});

		//adding average comparison line
		var avg_female = 1100
		var avg_male = 1430
		//female 14 - 50
		svg_grains.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_grain(avg_female))
				.attr("x2", 850)
				.attr("y2", padding + yscale_grain(avg_female))
				.style("stroke", "ff80df")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		//male 14 - 50
		svg_grains.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_grain(avg_male))
				.attr("x2", 850)
				.attr("y2", padding + yscale_grain(avg_male))
				.style("stroke", "3385ff")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		</script>
	</div>

	<div id = "Vegetables">
		<script> 
		var svg_veggies = createGraph("Vegetables", ["Vegetables"],"#009926", yscale_veg);

		data.forEach(function(obj) {
			svg_veggies.append("rect")
						.attr("x", xscale(obj.Country) +x_pad)
						.attr("y", yscale_veg(obj.Vegetables) + padding)
						.attr("width", 15)
						.attr("height", yscale_veg(0) - yscale_veg(obj.Vegetables) )
						.style("fill", veg_colors[0])
						.style("stroke", "#ccc")
						.style("stroke-width", "1");
		});

		</script>
	</div>

	<div id = "Fruits">
		<script> 
		var svg_fruits = createGraph("Fruits", ["Fruit"],"#cc0000",yscale_fruit);
		data.forEach(function(obj){
			svg_fruits.append("rect")
						.attr("x", xscale(obj.Country) + x_pad)
						.attr("y", yscale_fruit(obj.Fruit) + padding)
						.attr("width", 15)
						.attr("height", yscale_fruit(0) - yscale_fruit(obj.Fruit))
						.style("fill", fruit_colors[0])
						.style("stroke", "#ccc")
						.style("stroke-width", "1");
		});
		</script>
	</div>

	<div id = "Oils">
		<script> 

		var svg_oils = createGraph("Oils", ["Saturated Fat", "Unsaturated Fat"],"#cccc00", yscale_oil);

		//Saturated fats: palm oil, coconut oil, sugars
		//Unsaturated fats: Olive oil, vegetable oil, soybean oil

		data.forEach( function(obj){
			var jsonRects = [
							{
								"x1": xscale(obj.Country) + x_pad, 
								"y1": yscale_oil(obj.Palm_Oil + obj.Sugars + obj.Coconut_Oil) + padding,
								"width1": 15, 
								"height1": yscale_oil(0) - yscale_oil(obj.Palm_Oil + obj.Sugars + obj.Coconut_Oil), 
								"fill1": oil_colors[1]
							},
							{
								"x1": xscale(obj.Country) + x_pad, 
								"y1": yscale_oil(obj.Soybean_Oil + obj.Olive_Oil + obj.Vegetable_Oil) + padding,
								"width1": 15, 
								"height1": yscale_oil(0) - yscale_oil(obj.Soybean_Oil+ obj.Olive_Oil + obj.Vegetable_Oil), 
								"fill1": oil_colors[0]}
								];

			//Sort rectangles by height
			jsonRects.sort(function (a,b) {
					if (a.y1 > b.y1) { return 1; }
					if (a.y1 < b.y1) { return -1; }
					return 0;
			});

			var rects = svg_oils.selectAll("jsonRects")
						.data(jsonRects)
						.enter()
						.append("rect");

			var rect_attributes = rects
						.attr("x", function(d) {return d.x1; })
						.attr("y", function(d) {return d.y1;})
						.attr("width", function(d) {return d.width1;})
						.attr("height", function(d) {return d.height1;})
						.style("fill", function(d) { return d.fill1; })
						.style("stroke", "#ccc")
						.style("stroke-width", "1");
		});

		//adding average comparison line
		var avg_female = 550
		var avg_male = 715
		//female 14 - 50
		svg_oils.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_oil(avg_female))
				.attr("x2", 850)
				.attr("y2", padding + yscale_oil(avg_female))
				.style("stroke", "ff80df")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		//male 14 - 50
		svg_oils.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_oil(avg_male))
				.attr("x2", 850)
				.attr("y2", padding + yscale_oil(avg_male))
				.style("stroke", "3385ff")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");

		</script>
	</div>

	<div id = "Dairy">
		<script> 
		var svg_milk = createGraph("Dairy", ["Milk", "Cheese"],"#00ace6", yscale_milk);
		data.forEach(function(obj){
			svg_milk.append("rect")
					.attr("x", xscale(obj.Country) + x_pad)
					.attr("y", yscale_milk(obj.Milk) + padding)
					.attr("width", 15)
					.attr("height", yscale_milk(0) - yscale_milk(obj.Milk))
					.style("fill", milk_colors[0])
					.style("stroke", "#ccc")
					.style("stroke-width", "1");
			svg_milk.append("rect")
					.attr("x", xscale(obj.Country) + x_pad)
					.attr("y", yscale_milk(obj.Cheese) + padding)
					.attr("width", 15)
					.attr("height", yscale_milk(0) - yscale_milk(obj.Cheese))
					.style("fill", milk_colors[1])
					.style("stroke", "#ccc")
					.style("stroke-width", "1");
		});
		</script>
	</div>

	<div id = "Protein">
		<script> 
		var svg_meat = createGraph("Protein", ["Meat", "Eggs", "Nuts", "Fish"],"#6600cc",yscale_protein);

		data.forEach( function(obj){
			var proteinJsonRects = [
							{ 
								"x1": xscale(obj.Country) + x_pad, 
								"y1": yscale_protein(obj.Meat) + padding,
								"width1": 15, 
								"height1": yscale_protein(0) - yscale_protein(obj.Meat) , 
								"fill1": protein_colors[0] 
							},
							{ 
								"x1": xscale(obj.Country) + x_pad, 
								"y1": yscale_protein(obj.Eggs) + padding,
								"width1": 15, 
								"height1": yscale_protein(0) - yscale_protein(obj.Eggs) , 
								"fill1": protein_colors[1] 
							},
							{ 
								"x1": xscale(obj.Country) + x_pad, 
								"y1": yscale_protein(obj.Nuts) + padding,
								"width1": 15, 
								"height1": yscale_protein(0) - yscale_protein(obj.Nuts) , 
								"fill1": protein_colors[2] 
							},
							{ 
								"x1": xscale(obj.Country) + x_pad, 
								"y1": yscale_protein(obj.Fish) + padding,
								"width1": 15, 
								"height1": yscale_protein(0) - yscale_protein(obj.Fish), 
								"fill1": protein_colors[3] 
							}
								];

			//Sort rectangles by height
			proteinJsonRects.sort(function (a,b) {
					if (a.y1 > b.y1) { return 1; }
					if (a.y1 < b.y1) { return -1; }
					return 0;
			});

			var rects = svg_meat.selectAll("proteinJsonRects")
						.data(proteinJsonRects)
						.enter()
						.append("rect");

			var rect_attributes = rects
						.attr("x", function(d) {return d.x1; })
						.attr("y", function(d) {return d.y1;})
						.attr("width", function(d) {return d.width1;})
						.attr("height", function(d) {return d.height1;})
						.style("fill", function(d) { return d.fill1; })
						.style("stroke", "#ccc")
						.style("stroke-width", "1");
		});

		//adding average comparison line
		var avg_female = 350;
		var avg_male = 585;
		//female 14 - 50
		svg_meat.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_protein(avg_female))
				.attr("x2", 850)
				.attr("y2", padding + yscale_protein(avg_female))
				.style("stroke", "ff80df")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		//male 14 - 50
		svg_meat.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_protein(avg_male))
				.attr("x2", 850)
				.attr("y2", padding + yscale_protein(avg_male))
				.style("stroke", "3385ff")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		</script>
	</div>

		<div id = "Total">
		<script> 
		var svg_total = createGraph("Total", ["Total"],"black", yscale_total);

		data.forEach(function(obj){
			svg_total.append("rect")
					.attr("x", xscale(obj.Country) + x_pad)
					.attr("y", yscale_total(obj.Total) + padding)
					.attr("width", 15)
					.attr("height", yscale_total(0) - yscale_total(obj.Total))
					.style("fill", total_colors[0])
					.style("stroke", "#ccc")
					.style("stroke-width", "1");
			});
		//adding average comparison line
		var avg_female = 2000
		var avg_male = 2600
		//female 14 - 50
		svg_total.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_total(avg_female))
				.attr("x2", 850)
				.attr("y2", padding + yscale_total(avg_female))
				.style("stroke", "ff80df")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		//male 14 - 50
		svg_total.append("line")
				.attr("x1", 2*padding + 20)
				.attr("y1", padding + yscale_total(avg_male))
				.attr("x2", 850)
				.attr("y2", padding + yscale_total(avg_male))
				.style("stroke", "3385ff")
				.style("opacity", "0.5")
				.style("stroke-width", "1.5");
		</script>
	</div>

	<div id = "BMI">
		<!-- MAP -->
	</div>
</body>
</html>